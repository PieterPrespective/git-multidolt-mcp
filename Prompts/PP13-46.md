- IssueID = PP13-46
- Please read 'Prompts/BasePrompt.md' first for general context
- Background: After completing PP13-45 (fixed remote parsing bug), the complete empty repository clone workflow now functions properly. However, users are encountering issues with invalid remote URLs that only surface after attempting a full clone operation, wasting time and resources.
- The current DoltCloneTool accepts various URL formats including 'https://www.dolthub.com/repositories/pieter-prespective/NewTestDatabase' but this format is invalid for dolt operations. The correct DoltHub URL format should be 'https://doltremoteapi.dolthub.com/pieter-prespective/NewTestDatabase' or the shorthand 'pieter-prespective/NewTestDatabase' (which gets converted to the correct URL).
- Current Issue: When users provide invalid URLs like 'https://www.dolthub.com/repositories/...', the system only discovers the URL is invalid after attempting the full clone process, leading to delayed error feedback and wasted processing time.
- Enhancement Required: Implement early URL validation by testing remote connectivity before attempting clone operations.
- Specific Requirements:
  1. **Enhanced Username/Database Support**: The current implementation already converts 'pieter-prespective/NewTestDatabase' to 'https://doltremoteapi.dolthub.com/pieter-prespective/NewTestDatabase' (lines 91-96 in DoltCloneTool.cs). Verify this works correctly and enhance if needed.
  2. **Pre-Clone Remote Validation**: After initializing the local dolt repository (in the fallback scenario), test remote validity by running 'dolt remote add origin {url}' using CLIwrap. If this fails with error message containing 'the table(s) remote, origin, {url} do not exist' or similar remote validation errors, immediately return an error indicating the remote URL is invalid without proceeding with the clone attempt.
  3. **Preserve Fallback Logic**: Ensure the existing empty repository fallback scenario remains intact - this new validation should be additive, not replacement functionality.
- Implementation Location: Enhance the DoltCloneTool.cs fallback logic (around lines 186-192) to add remote validation before proceeding with repository initialization.
- Testing Requirements: Create test cases that verify:
  - Valid username/database format conversion works correctly
  - Invalid remote URLs are detected early and fail fast
  - Valid remote URLs pass validation and proceed normally
  - Existing empty repository fallback workflow remains functional
- Expected Outcome: Users receive immediate feedback when providing invalid remote URLs, reducing wait times and improving user experience during repository setup operations.